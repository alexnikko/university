1 Introduction
Analysis of data from electroencephalogram (EEG) recordings is necessary for many clinical studies as well as for research on human and animal subjects. Conventional analyses of EEG signals for sleep scoring are based on the time domain-based assessment of wave patterns [ ], and these assignments rely on the direct visualization of EEG epochs.
The original sleep classification system devised by Rechtschaffen & Kales was based on visual recognition and manual measurements of chart recordings [ ]. However, this method of analysis can be tedious, time consuming, and prone to human error. For example, patterns of fast EEG activity cannot be detected by visual scoring due to their low amplitudes. In addition, the time-consuming nature of polysomnography is an obstacle to the growing adoption of this technique.
To address these rising demands, numerous attempts have been made to automate the process of sleep identification from EEG recordings using computers. Such methods have utilized frequency domain signal-processing techniques, such as fast Fourier transform (FFT), power spectral analysis (PSA) and neural network classifiers [ , ], to varying degrees of success, and the results have been highly dependent on the number of signals recorded, the selection of significant features, and the robustness of the scoring algorithms [ ]. The neural network classifier, for example, requires a prior set of EEG signals for training before it can be implemented. In other words, it is important to acknowledge that all current methods for computer-aided EEG analysis have significant limitations, which can lead to failures in the detection of real events and/or the inappropriate scoring of events that do not exist [ ]. Therefore, a significant increase in the efficiency of such computer-based methods is required before they can be effectively utilized by sleep researchers.
To address this problem, we developed a semi-automated algorithm in Matlab (The Mathworks, Natick, MA) for the quantitative analysis of EEG and electromyogram (EMG) signals collected from free-moving mice during spontaneous behavior, which was developed. This automated algorithm allowed for the analysis of a large set of EEG recordings data in a convenient manner, and it yielded results that were relatively free of redundancy and artifacts. Furthermore, the algorithm performed well in EEG analyses, showing a 92% accordance level with the standard waveform-recognition procedure. We demonstrate that this algorithm is a reliable tool for automated detection of the three vigilance states and that it eliminates inconsistencies due to manual scoring; furthermore, it should reduce the time required for expert analysis. Finally, as this algorithm uses relative rather than absolute thresholds, it may be appropriate for a wide range of applications.
2 Materials and Methods
2.1 Animals
Experiments were performed on 12 male inbred C57BL/6 mice (22–26 g; 11–13 weeks of age), which were obtained from the Laboratory Animal Center, Chinese Academy of Sciences (Shanghai, China). The animals were housed in an insulated and soundproofed recording room that was maintained at an ambient temperature of 22 ± 0.5°C with a relative humidity of 60 ± 2% under an automatically controlled 12-h light/12-h dark cycle (light on at 0800 h, illumination intensity ≈100 lux). The animals were given free access to food and water. Experimental protocols were approved by the Medical Experimental Animal Administrative Committee of Shanghai. Furthermore, all reasonable efforts were made to minimize the number of animals used in this study and to alleviate any pain and discomfort that may have been experienced by the subjects.
2.2 Polysomnographic Recordings
The mice were implanted with chronic EEG and EMG electrodes for polysomnographic recording under pentobarbital anesthesia (50 mg/kg i.p.). To serve as EEG electrodes, two stainless-steel screws (1 mm in diameter) were implanted through the skull above the cortex (anteroposterior, +1.0 mm; left–right, −1.5 mm from bregma or lambda), based on the atlas of Franklin and Paxinos [ ]. To serve as EMG electrodes, two insulated stainless steel, Teflon-coated wires were bilaterally implanted into both trapezius muscles. All electrodes were attached to a single micro-connector and fixed to the skull with dental cement.
The EEG and EMG recordings were performed using a slipring, which was designed to allow for natural behavioral movements. Following a 10-day recovery period, the animals were housed individually in transparent barrels and habituated to the recording cable for 3–4 days prior to polygraphic recording. Each animal was recorded for 24 h, beginning at the onset of the light period (0800 h).
First, cortical EEG and EMG signals were amplified and filtered (EEG, 0.5–30 Hz; EMG, 20–200 Hz) and then digitized at a sampling rate of 128 Hz. EEG and EMG recording were made using SLEEPSIGN (Kissei Comtec, Nagano, Japan) [ ]. Following data collection, polygraphic recordings were automatically scored offline using SLEEPSIGN (4-s epochs) to determine periods of wakefulness, rapid eye movement (REM) sleep, and non-REM (NREM) sleep, according to standard criteria [ , , ]. Finally, the defined sleep/wake stages were visually examined and corrected when necessary.
2.3 Visual Scoring
Wakefulness, NREM, and REM sleep were determined visually in 4-s epochs based on the chart records using standard EEG and EMG criteria. Wakefulness is generally defined by a low-amplitude, high-frequency EEG pattern [ , , ]. NREM sleep is defined by high-amplitude EEG and low-voltage EMG patterns, and this state is also characterized by the presence of high EEG delta activity (0.65–4 Hz). Finally, REM sleep is commonly defined by low-amplitude, high-frequency EEG patterns and the absence of EMG activity; furthermore, the presence of EEG theta activity (6–9 Hz) can be used to confirm this state [ , ].
To define the background EEG levels, the raw signal was band-pass-filtered into 3 different frequency bands (delta: 0.65–4 Hz; theta: 6–9 Hz; alpha: 12–14 Hz), and the predominant activity (density), mean amplitude (intensity), mean frequency, and variability were determined for each frequency band as well as for the total band (0–25 Hz).
2.4 Algorithm-Based FFT Analysis
The algorithm was designed as a five-step process (Fig. 1 ) and was based on preliminary recordings from six mice. As previously described [ ], online power spectral analysis was performed using an FFT with 4-s epochs, producing a power spectrum with a resolution of 0.25 Hz; the corresponding FFT size was 512. The power spectra of the EEG and EMG patterns for one epoch are described as: $$ {\text{EEG}}\_{\text{powerspeca}}_{n,k} $$ (1) and $$ {\text{EMG}}\_{\text{powerspeca}}_{n,k} , $$ (2) where n is the index of the epoch (1, 2, 3, 4…), and k is the frequency index (1…512); The frequency range is from 0 to 64 Hz. As the time domain signals of the EEG and EMG patterns are real, the frequency signals have conjugate symmetry; therefore, we can only use half of the points of the power spectra. The following computational formula was used: $$ {\text{EMG}}\_{\text{powersum}}_{n} = \sum\limits_{k = 1}^{k = 256} {{\text{EMG}}\_{\text{powerspeca}}_{n,k} } \quad \left( {{\text{Freq range}}: \, 0:0.25:63.75} \right). $$ (3) Fig. 1 A procedural chart for the algorithm as implemented in a software program developed on Matlab version 7.0. This algorithm is composed of five steps. Step (1) determining the EMG–power ratio. This step can be divided into three second-level steps: sorting EMG–power, acquiring mean-EMG-energy, and determining the EMG–power ratio. Step (2) determining the three energy areas ( high , middle , and low ) using EMG–power ratio thresholds (e.g., 5.5 and 6). Step (3) determining the θ / δ ratio. Step (4) distinguishing wakefulness from NREM sleep using the θ / δ ratio in the middle-energy area. If the value of the θ / δ ratio is equal to or greater than 0.5, the stage is judged as wakefulness; otherwise, it is judged as NREM sleep. Step (5) distinguishing REM from NREM sleep using the θ / δ ratio in the low-energy area. If the value of the θ / δ ratio is equal to or greater than 2, the state is judged as REM sleep; otherwise, it is judged as NREM sleep
Given an epoch number of N , the \( {\text{EMG}}\_{\text{powersum}}_{n} \) values were sorted, and the smallest 1000 epochs were chosen. The mean value of the 1000 epochs was then computed as follows: $$ {\text{EMG}}\_{\text{powersmallmean}}. $$ (4) Consequently, the EMG–power ratio was expressed as: $$ {\text{EMG}}\_{\text{powersum}}\_{\text{ratio}}_{n} = \frac{{{\text{EMG}}\_{\text{powersum}}_{n} }}{{{\text{EMG}}\_{\text{powersmallmean}}}}. $$ (5) The above constituted the first step in our algorithm.
The EMG–power ratio provided a good discriminator of the three energy areas in the second step. These three areas are referred to as the high-, middle-, and low-energy areas, as shown in the procedure chart. The θ / δ ratio allowed for good discrimination between NREM sleep and wakefulness, as well as between NREM and REM sleep in more divided areas.
In the third step, we utilized the θ / δ ratio. The power calculations of REM and NREM sleep waves were based on the entire frequency of the EMG pattern using the following formulas: $$ {\text{Delta}}\_{\text{EEG}}\_{\text{powersum}}_{n} = \sum\limits_{k = 2}^{k = 17} {{\text{EEG}}\_{\text{powerspeca}}_{n,k} } \quad \left( {{\text{Freq range}}: \, 0. 5:0. 2 5: 4} \right) $$ (6) and $$ {\text{Theta}}\_{\text{EEG}}\_{\text{powersum}}_{n} = \sum\limits_{k = 25}^{k = 41} {{\text{EEG}}\_{\text{powerspeca}}_{n,k} } \quad \left( {{\text{Freq range}}:{ 6}:0. 2 5: 10} \right). $$ (7)
Accordingly, the θ / δ ratio was expressed as: $$ {\text{Theta}}\_{\text{Delta}}\_{\text{ratio}}_{n} = \frac{{{\text{Theta}}\_{\text{EEG}}\_{\text{powersum}}_{n} }}{{{\text{Delta}}\_{\text{EEG}}\_{\text{powersum}}_{n} }}. $$ (8)
In step 4, the middle-energy area was further divided into wakefulness and NREM sleep based on the θ / δ ratio; as a result, the low-energy area was separated into NREM and REM sleep.
2.5 Decision Threshold Determination
Finally, we selected the EMG–power ratio and the EEG θ / δ ratio in our algorithm as first- and second-level thresholds, respectively. The algorithm was based on results from six animals (Figs. 2 , 3 ). Three typical examples of the data demonstrate that the EMG–power ratio can be used to approximately discriminate between wakefulness and REM/NREM sleep (Fig. 2 ). However, it cannot be used to distinguish between REM and NREM sleep, as the majority of the epochs during these two stages have similar EMG–power ratio values. Based on the EMG–power ratio, all epochs can be divided into high-, middle-, and low-energy areas. Epochs in the high-energy area were reliable indicators of wakefulness. However, the middle-energy areas represented a mixture of wakefulness and NREM sleep, whereas the low-energy areas represented a mixture of NREM and REM sleep (Fig. 2 ). Fig. 2 The distribution of the EMG–power ratio in relation to the epoch numbers of the three vigilance states in all three energy areas using a summarized data set from three mouse EEG signals. This panel demonstrates that wakefulness can be distinguished from the other two vigilance states using only the EMG–power ratio, whereas REM and NREM sleep cannot be differentiated using this parameter alone Fig. 3 a The distribution of the θ / δ ratio in relation to the epoch numbers of the three vigilance states in the middle-energy area using a summarized data set from three mouse EEG signals. As the REM-sleep epoch number was very small in the middle-energy area, we could only distinguished wakefulness from NREM sleep using the θ / δ ratio in the middle-energy area. If the value of the θ / δ ratio was equal to or greater than 0.5, the stage was judged as wakefulness; otherwise, it was judged as NREM sleep. b The distribution of the θ / δ ratio in relation to the epoch numbers of the REM- and NREM-sleep states in the low-energy area using a summarized data set from three mouse EEG signals. If the value of the θ / δ ratio was equal to or greater than 2, it was judged as REM sleep; otherwise, it was judged as NREM sleep
To further divide the middle- and low-energy areas, the θ / δ ratio was utilized, as shown in Fig. 3 . Due to the small number of REM-sleep epochs in middle-energy areas, this sleep state was ignored, and the epochs were treated as representing only wakefulness and NREM sleep. The epoch distribution from a middle-energy area, representing wakefulness, REM, and NREM sleep is presented in Fig. 3 a. This figure also helps to visualize how the second-level threshold was determined, as the θ / δ ratio for wakefulness in the middle-energy area was generally equal to or greater than 0.5, whereas the θ / δ ratio for NREM sleep was less than 0.5. The distribution numbers of REM and NREM epochs in the low-energy area are presented in Fig. 3 b. In the low-energy area, the value of the θ / δ ratio for REM sleep was generally equal to or greater than 2, whereas the corresponding values for NREM sleep were less than 2, as shown in Fig. 3 b.
To accurately determine the values of the two stage thresholds, the epoch error ratios from the high- and low-energy areas were determined (Fig. 4 ). These results illustrate the error ratios from the high- and low-energy areas, which were based on the EMG–power ratio. We determined that 6 and 5.5 were appropriate EMG–power ratio thresholds for the high- and low-energy areas, respectively (Fig. 4 a, b). In a similar fashion, the second-level thresholds were defined as θ / δ ratios of 2 and 0.5 (Fig. 4 c, d). Fig. 4 a Error ratios of the first-level thresholds in the three energy areas using a summarized data set from three mouse EEG signals. We calculated the threshold of the high-energy area to be 6. b Error ratios of thresholds in the low-energy areas using a summarized data set from three mouse EEG signals. We calculated the threshold of the low-energy area to be 5.5. c Error ratios of the θ / δ thresholds used to separate REM and NREM sleep in the low-energy area. We calculated that a θ / δ ratio of 2 was the optimal second-level threshold to distinguish REM from NREM sleep in the low-energy area. d Error ratios of the θ / δ thresholds for all three vigilance states in the low-energy area. We calculated that a θ / δ ratio of 0.5 was the optimal second-level threshold to distinguish NREM sleep from wakefulness in the middle-energy area
3 Results
Six additional mice were used to validate the algorithm. The computerized method was applied to each of the six EEG recordings, and in each case, the output of the system was recorded to evaluate its performance against visual scoring and for subsequent examination. The results of the algorithm were compared with those from an expert’s visual examination, and the outcomes were then corrected. The signals determined visually by the experts were regarded as the criteria.
The algorithm showed satisfactory performance with respect to sleep-state prediction and artifact correction during both simulations and investigations with real data. The average accuracy of the computer-based algorithm was 90.60 ± 1.40% compared with visual scoring. The average accuracy for each vigilance state was 94.60% for wakefulness, 92.62% for NREM sleep, and 70.98% for REM sleep as shown in Fig. 5 . Fig. 5 Accuracy of the computer-based method of vigilance-state detection compared with visual scoring in six mice. The average accuracy for each vigilance state was 94.60% for wakefulness, 92.62% for NREM sleep, and 70.98% for REM sleep
4 Discussion
In this study, we developed and tested an algorithm for the automated analysis of overnight EEG and EMG recordings that is capable of differentiating between three states: wakefulness, NREM sleep, and REM sleep.
4.1 Features of the Algorithm
The algorithm has the following unique aspects: (I) the algorithm incorporates Parseval’s relation; (II) relative thresholds, instead of absolute thresholds, were applied; (III) thresholds were based on EEG and EMG frequency; (IV) low-, middle-, and high-energy areas were determined based on first-level thresholds; (V) second-level thresholds were introduced to further subdivide the vigilance states.
Our algorithm is based on the proposition that total energy in the time domain is equal to that of the frequency domain, according to Parseval’s relation: $$ \sum\limits_{n = 0}^{N - 1} {\left\lfloor {x(n)} \right\rfloor }^{2} = \frac{1}{N}\sum\limits_{k = 0}^{N - 1} {\left\lfloor {X(k)} \right\rfloor }^{2} . $$ (9)
Therefore, \( {\text{EMG}}\_{\text{powersum}}_{n} , \) which is equivalent to the value of the time domain, was used to calculate the EMG–power ratio. Although there have been many published algorithms on this subject, all have applied absolute rather than relative thresholds, which limits their effectiveness [ , ]. In contrast, relative thresholds were used in our algorithm, which should make it suitable for a wide range of applications. To determine our second-level thresholds, we used the θ / δ ratio instead of ( δ × α )/( β × γ ) or θ 2 / δ × α , as proposed by Louis et al. [ ]. In particular, the latter parameter can result in an overly wide threshold range, leading to uncertainties in defining the thresholds. In contrast, relative thresholds possess a number of advantages over absolute thresholds, one of which is modifiable parameters that can allow the algorithm to be used in other systems.
4.2 Optimal Threshold Determination
To determine the optimal threshold, the error ratios of the three energy areas were analyzed. The error ratio in the high-energy area, which illustrates the error ratio of wakefulness epochs misjudged as REM- or NREM-sleep epochs compared with the total number of epochs in the high-energy area, is presented in Fig. 4 a. The error ratio of wakefulness epochs misjudged as REM- or NREM-sleep epochs compared with the total number of epochs in the low-energy area is presented in Fig. 4 b. Higher threshold did not indicate better performance. When thresholds get higher, Epoch numbers falling into high-energy area get smaller and more Epochs fall into middle-energy area, despite the error ratio compared to the threshold become small. This would lead to an increase of error ratio in the middle-energy area; thus, the total error rate increased actually. Similarly, as shown in Fig. 4 b, despite the error ratio decreased as the threshold decrease, Epoch numbers falling into low-energy area was smaller and more Epochs fall into middle-energy area. This would also increase the total error rate actually. Therefore, only by taking compromise values in the process of first-level threshold setting, could we optimize the state recognition in the high, middle and low energy areas.
Although the error ratios in the high- and low-energy areas decreased and increased, respectively—which was accompanied by an increase of the EMG–power ratio—the thresholds were calculated to be 6 and 5.5 to reduce the range of the middle-energy area. Other error ratios in the low-energy area are shown in Fig. 4 c, where misjudged REM- and NREM-sleep epochs are compared with the total number of epochs. The ratios of all misjudged epochs in the middle-energy area compared with the total number of epochs in this area are summarized in Fig. 4 d. Finally, the θ / δ ratios were determined to be 2 and 0.5 to reduce the error rate in Fig. 4 c, d.
We also found using this algorithm that REM and NREM sleep cannot be distinguished from each other using only the EMG–power ratio, which had also been described by Louis et al. [ ]. The limitation of our study is that the average accuracy for REM sleep recognition was only 70.98% and cannot reach 90% as Stephenson et al. described [ ]. The sampling frequency is only 128 Hz for our instrument, while the analog signals sampling at 400 Hz for Stephenson et al. According to the Nernst theorem, the highest sampling we can get is 64 Hz. The sampling frequency limits our recognition of EEG.
In conclusion, this algorithm is a reliable tool for automated detection of the three vigilance states and that it eliminates inconsistencies due to manual scoring and; furthermore, it should reduce the time required for expert analysis.